<body>

  <!-- Next Steps: Bring in control data for comparison and have distribution functions displayed better.-->

  <!--
    Uses a user input for the cohort list and gene list. These input lists should be comma seperated values.
  -->

  <!--
    This code bellow is for import jobs.
  -->
  <head>
    <script type="text/javascript" src = "https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="ethan_style.css">
    <script type="text/javascript" src = "ethan_master.js"></script>
    <script type="text/javascript" src = "ethan_data_import.js"></script>
    <script type="text/javascript" src = "ethan_mRNASeq_histogram.js"></script>
    <script type="text/javascript" src = "ethan_mRNASeq_heatmaps.js"></script>
    <script type="text/javascript" src = "ethan_doc_manipulation.js"></script>
  </head>
  
  <!--
    This code bellow sets up the main heading.
  -->
  <body>
    <h1 class="PageTitle">WebGen's mRNA-Seq Visualization API</h1>
  
  <!--
    This code bellow sets up the user input text fields and buttons.
  -->
  <input class="CohortGenesInput" id='cohort_list' placeholder="Enter List of Cancer Cohorts Here">
  <input class="CohortGenesInput" id='gene_list' placeholder="Enter List of Genes Here">
  <button class="exampleSubmitButton" onclick="setExampleVars()" id='exampleButton'>
    Use Example
  </button>
  <button class="exampleSubmitButton" onclick="setVars()" id='button1'>
    Submit
  </button>

  <!--
    This code bellow initializes the first div element.
  -->
  <div id=div0 style="margin-top:25px"></div>

  <!--
    This code bellow creates button for alert message on an error.
  
  -->
  <span class="closebtn" id='span0' onclick="this.parentElement.style.display='none';">&times;</span>
  

  <!--
    This code bellow contains the JS code for building the plots to display.
  -->
  <script type="text/javascript">
    // Wait for user input to build plots:
    function setVars() {
      // Reset page formatting:
      document.getElementById('div0').innerHTML="";
      document.getElementById('links').style.position = 'absolute';                      // Move links to stay at the bottom of the page.
      
      // Removes existing divs if they're there:
      removeElements();

      // Display loader:
      document.getElementById('div0').className = 'loader';                              // Create the loader.

      // Set user input variables:
      var cohort_list = document.getElementById('cohort_list').value.toUpperCase().split(',');  
      var gene_list = document.getElementById('gene_list').value.toUpperCase().split(',');
      var cohort_list = cohort_list.map(x => x.trim());
      var gene_list = gene_list.map(x => x.trim());

      // Check the cohort list to be valid:
      validCohorts = checkCohortList(cohort_list);
      if (validCohorts == false) {
        document.getElementById('div0').classList.remove('loader');                        // Remove the loader.
        showError('cohortError');
        return;
      }

      // Fetch RNA sequence data and display requested plots:
      var dataToPlotInfo = ethan_getEFDdata(cohort_list, gene_list);

      // Once data is returned, build the plots:
      dataToPlotInfo.then(function(data) {
        //Check that the fetch worked:
        if (data == 'Error: Invalid Input Fields for Query.') {
          document.getElementById('div0').classList.remove('loader');                      // Remove the loader.
          showError('geneError');
          return;
        }

        var dataToPlot = data[0];
        var layoutArray = data[1];

        // Get the genes with no mRNA-Seq data results:
        var emptyGenesArray = data[2];
        var j = 0;
        if (emptyGenesArray.length > 0) {
          var j = 1;
        };

        // Create plot for each gene/cohort combination:
        var L = dataToPlot.length
        document.getElementById('div0').classList.remove('loader');                        // Remove the loader.
        for (var i = j; i < L+j; i ++) {
          if (i>0) {
            addElement("div"+i,"div"+(i-1));                                               // Append new Div elements.
          };
          Plotly.newPlot("div"+i, dataToPlot[i-j], layoutArray[i-j], {responsive: true});  // Create all plots
        };
        document.getElementById('links').style.position = 'relative';                      // Move links to stay at the bottom of the page.
      });
    };
  </script>

  <!--
    This code bellow is for if the user wants to use the example input cohort and gene lists.
  -->
  <script>
  // This script is to set the cohort and gene list examples if the user clicks the use example button:
  function setExampleVars() {
      document.getElementById('cohort_list').value = 'BRCA, SARC';
      document.getElementById('gene_list').value = 'BRCA1, EGFR, KRAS, TP53';
    };
  </script>
  

  <!--
    This code bellow is to display relevant hyperlinks for the page.
  -->
  <div id="links" class="relevantLinks">
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://github.com/web4bio/webgen">Team GitHub Page</a>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://www.stonybrook.edu/commcms/vertically-integrated-projects/teams/_team_page/team_page.php?team=WebGen%20(Web%20Genomics)">Stony Brook University's VIP Page</a>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="https://portal.gdc.cancer.gov">NCI's Genomic Data Commons</a>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <a href="http://firebrowse.org/">Firebrowse by the Broad Institute</a>
  </div>

</body>